{% extends "layouts/reporting.html" %}
{% from "govuk/components/phase-banner/macro.njk" import govukPhaseBanner %}
{%- from "moj/components/sub-navigation/macro.njk" import mojSubNavigation -%}

{% set pageName="Reporting" %}
{% block beforeContent %}
{{super()}}
<!-- {{navbar("reporting", true, true)}} -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}
{% block content %}

<div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">

        <!--    {% include "govuk-prototype-kit/includes/homepage-top.njk" %}-->

        <span class="govuk-caption-m">Cabinet Office</span>
        <h1 class="govuk-heading-l">Completed learning</h1>

        <!--    {% include "govuk-prototype-kit/includes/homepage-bottom.njk" %}-->
    </div>
</div>

<div class="govuk-grid-row">
    <div class="govuk-grid-column-one-third">
		<form action="/reporting" method="post">
        <h2 class="govuk-heading-m">
            Filter {{custom}}
        </h2>
        {% set whenHtml %}
            {% set customRadio %}
                {{ govukInput({
                    id: "custom-from",
                    name: "custom-from",
                    type: "text",
                    autocomplete: "text",
                    spellcheck: false,
                    label: {
                        text: "From date"
                    }
                }) }}
                {{ govukInput({
                    id: "custom-to",
                    name: "custom-to",
                    type: "text",
                    autocomplete: "text",
                    spellcheck: false,
                    label: {
                        text: "To date"
                    }
                }) }}
            {% endset -%}
            {{ govukRadios({
                classes: "govuk-radios--small",
                name: "date-range",
                items: [
                    {
                        value: "today",
                        text: "Today",
                        checked: dateRange == "today" or dateRange == null
                    },
                    {
                        value: "past-seven-days",
                        text: "Past seven days",
						checked: dateRange == "past-seven-days"
                    },
                    {
                        value: "past-month",
                        text: "Past month",
						checked: dateRange == "past-month"
                    },
                    {
                        value: "past-year",
                        text: "Past year",
						checked: dateRange == "past-year"
                    },
                    {
                        value: "custom",
                        text: "Custom",
                        conditional: {
                            html: customRadio
                        }
                    }
                ]
            }) }}
        {% endset -%}
        {% set depHtml %}
            {{ govukCheckboxes({
                name: "include-subdepartments",
                classes: "govuk-checkboxes--small",
                items: [
                    {
                        value: "include-subdepts",
                        text: "Include sub-departments",
						checked: includeSubdepartments !== "_unchecked"
                    }
                ]
            }) }}
        {% endset -%}
        {% set requiredLearningHtml %}
            {{ govukRadios({
                classes: "govuk-radios--small",
                name: "mandatory-learning",
                items: [
                    {
                        value: "all-learning",
                        text: "All learning",
                        checked: mandatoryLearning == "all-learning" or mandatoryLearning == null
                    },
                    {
                        value: "required-learning",
                        text: "Required learning",
						checked: mandatoryLearning == "required-learning"
                    },
                    {
                        value: "non-required-learning",
                        text: "Non-required learning",
						checked: mandatoryLearning == "non-required-learning"
                    }
                ]
            }) }}
        {% endset -%}
        {% set gradeHtml %}
            {{ govukCheckboxes({
                name: "grade",
                classes: "govuk-checkboxes--small",
                items: [
                    {
                        value: "heo",
                        text: "HEOD",
						checked: grades["heo"]
                    },
                    {
                        value: "grade-7",
                        text: "Grade 7",
                        checked:  grades["grade-7"]
                    },
                    {
                        value: "grade-6",
                        text: "Grade 6",
						checked: grades["grade-6"]
                    }
                ]
            }) }}
        {% endset -%}
        {% set professionHtml %}
            {{ govukCheckboxes({
                name: "profession",
                classes: "govuk-checkboxes--small",
                items: [
                    {
                        value: "finance",
                        text: "Finance",
						checked: professions["finance"]
                    },
                    {
                        value: "ddat",
                        text: "DDAT",
                        checked: professions["ddat"]
                    },
                    {
                        value: "administritive",
                        text: "Administritive",
						checked: professions["administritive"]
                    }
                ]
            }) }}
        {% endset -%}
        <div class="app-c-expander" data-module="expander" data-open-on-load="true">
            <h3 class="app-c-expander__heading">
                <span class="app-c-expander__title js-toggle">Date</span>
                <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="app-c-expander__icon app-c-expander__icon--up" aria-hidden="true" focusable="false"><path d="m798.16 609.84l-256-256c-16.683-16.683-43.691-16.683-60.331 0l-256 256c-16.683 16.683-16.683 43.691 0 60.331s43.691 16.683 60.331 0l225.84-225.84 225.84 225.84c16.683 16.683 43.691 16.683 60.331 0s16.683-43.691 0-60.331z"></path></svg>
                <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="app-c-expander__icon app-c-expander__icon--down" aria-hidden="true" focusable="false"><path d="m225.84 414.16l256 256c16.683 16.683 43.691 16.683 60.331 0l256-256c16.683-16.683 16.683-43.691 0-60.331s-43.691-16.683-60.331 0l-225.84 225.84-225.84-225.84c-16.683-16.683-43.691-16.683-60.331 0s-16.683 43.691 0 60.331z"></path></svg>
            </h3>
            <div class="app-c-expander__content js-content app-c-expander__content--visible" id="expander-content">
                {{ whenHtml | safe}}
            </div>
        </div>
        <div class="app-c-expander" data-module="expander" data-open-on-load="false">
            <h3 class="app-c-expander__heading">
                <span class="app-c-expander__title js-toggle">Departments</span>
                <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="app-c-expander__icon app-c-expander__icon--up" aria-hidden="true" focusable="false"><path d="m798.16 609.84l-256-256c-16.683-16.683-43.691-16.683-60.331 0l-256 256c-16.683 16.683-16.683 43.691 0 60.331s43.691 16.683 60.331 0l225.84-225.84 225.84 225.84c16.683 16.683 43.691 16.683 60.331 0s16.683-43.691 0-60.331z"></path></svg>
                <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="app-c-expander__icon app-c-expander__icon--down" aria-hidden="true" focusable="false"><path d="m225.84 414.16l256 256c16.683 16.683 43.691 16.683 60.331 0l256-256c16.683-16.683 16.683-43.691 0-60.331s-43.691-16.683-60.331 0l-225.84 225.84-225.84-225.84c-16.683-16.683-43.691-16.683-60.331 0s-16.683 43.691 0 60.331z"></path></svg>
            </h3>
            <div class="app-c-expander__content js-content" id="expander-content-f71d93d0">
                {{ depHtml | safe }}
            </div>
        </div>
        <div class="app-c-expander" data-module="expander" data-open-on-load="false">
            <h3 class="app-c-expander__heading">
                <span class="app-c-expander__title js-toggle">Type of learning</span>
                <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="app-c-expander__icon app-c-expander__icon--up" aria-hidden="true" focusable="false"><path d="m798.16 609.84l-256-256c-16.683-16.683-43.691-16.683-60.331 0l-256 256c-16.683 16.683-16.683 43.691 0 60.331s43.691 16.683 60.331 0l225.84-225.84 225.84 225.84c16.683 16.683 43.691 16.683 60.331 0s16.683-43.691 0-60.331z"></path></svg>
                <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="app-c-expander__icon app-c-expander__icon--down" aria-hidden="true" focusable="false"><path d="m225.84 414.16l256 256c16.683 16.683 43.691 16.683 60.331 0l256-256c16.683-16.683 16.683-43.691 0-60.331s-43.691-16.683-60.331 0l-225.84 225.84-225.84-225.84c-16.683-16.683-43.691-16.683-60.331 0s-16.683 43.691 0 60.331z"></path></svg>
            </h3>
            <div class="app-c-expander__content js-content" id="expander-content-f71d93c0">
                {{ requiredLearningHtml | safe }}
            </div>
        </div>
        <div class="app-c-expander" data-module="expander" data-open-on-load="false">
            <h3 class="app-c-expander__heading">
                <span class="app-c-expander__title js-toggle">Grade</span>
                <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="app-c-expander__icon app-c-expander__icon--up" aria-hidden="true" focusable="false"><path d="m798.16 609.84l-256-256c-16.683-16.683-43.691-16.683-60.331 0l-256 256c-16.683 16.683-16.683 43.691 0 60.331s43.691 16.683 60.331 0l225.84-225.84 225.84 225.84c16.683 16.683 43.691 16.683 60.331 0s16.683-43.691 0-60.331z"></path></svg>
                <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="app-c-expander__icon app-c-expander__icon--down" aria-hidden="true" focusable="false"><path d="m225.84 414.16l256 256c16.683 16.683 43.691 16.683 60.331 0l256-256c16.683-16.683 16.683-43.691 0-60.331s-43.691-16.683-60.331 0l-225.84 225.84-225.84-225.84c-16.683-16.683-43.691-16.683-60.331 0s-16.683 43.691 0 60.331z"></path></svg>
            </h3>
            <div class="app-c-expander__content js-content" id="expander-content-f71d93c1">
                {{ gradeHtml | safe }}
            </div>
        </div>
        <div class="app-c-expander govuk-!-margin-bottom-6" data-module="expander" data-open-on-load="false">
            <h3 class="app-c-expander__heading">
                <span class="app-c-expander__title js-toggle">Profession</span>
                <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="app-c-expander__icon app-c-expander__icon--up" aria-hidden="true" focusable="false"><path d="m798.16 609.84l-256-256c-16.683-16.683-43.691-16.683-60.331 0l-256 256c-16.683 16.683-16.683 43.691 0 60.331s43.691 16.683 60.331 0l225.84-225.84 225.84 225.84c16.683 16.683 43.691 16.683 60.331 0s16.683-43.691 0-60.331z"></path></svg>
                <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="app-c-expander__icon app-c-expander__icon--down" aria-hidden="true" focusable="false"><path d="m225.84 414.16l256 256c16.683 16.683 43.691 16.683 60.331 0l256-256c16.683-16.683 16.683-43.691 0-60.331s-43.691-16.683-60.331 0l-225.84 225.84-225.84-225.84c-16.683-16.683-43.691-16.683-60.331 0s-16.683 43.691 0 60.331z"></path></svg>
            </h3>
            <div class="app-c-expander__content js-content" id="expander-content-f71d93c2">
                {{ professionHtml | safe }}
            </div>
        </div>
        {{ govukButton({
			element: "input",
            text: "Apply filters"
        }) }}
	</form>
    </div>
    <div class="govuk-grid-column-two-thirds">
        {% set chartHtml %}
            <h2 class="govuk-heading-m">Chart</h2>
            <div class="govuk-!-padding-bottom-8">
                <canvas id="myChart"></canvas>
            </div>
            {{ govukButton({
                text: "Download chart data (.csv)"
            }) }}
        {% endset -%}
        {% set tableHtml %}
            <h2 class="govuk-heading-m">Table</h2>
            {{ govukTable({
                firstCellIsHeader: true,
                head: [
                    {
                        text: "Month"
                    },
                    {
                        text: "# of Completions"
                    }
                ],
                rows: [
                    [
                        {
                            text: "January"
                        },
                        {
                            text: "100"
                        }
                    ],
                    [
                        {
                            text: "February"
                        },
                        {
                            text: "257"
                        }
                    ],
                    [
                        {
                            text: "March"
                        },
                        {
                            text: "948"
                        }
                    ],
                    [
                        {
                            text: "April"
                        },
                        {
                            text: "450"
                        }
                    ],
                    [
                        {
                            text: "May"
                        },
                        {
                            text: "550"
                        }
                    ]
                ]
            }) }}
        {% endset -%}
{#        <h2 class="govuk-heading-s">#}
{#            Current filters#}
{#        </h2>#}
{#        <div class="tag-container">#}
{#            <span class="tag">Department: <span class="tag__accent">Cabinet Office</span></span>#}
{#            <span class="tag">When: <span class="tag__accent">Past Year</span></span>#}
{#            <span class="tag">Required learning</span>#}
{#            <span class="tag">Include sub-departments</span>#}
{#            <span class="tag">All grades</span>#}
{#            <span class="tag">All professions</span>#}
{#        </div>#}
{#        <h2 class="govuk-heading-s">#}
{#            Data#}
{#        </h2>#}
        {{ govukTabs({
            items: [
                {
                    label: "Chart",
                    id: "chart",
                    panel: {
                        html: chartHtml
                    }
                },
                {
                    label: "Table",
                    id: "table",
                    panel: {
                        html: tableHtml
                    }
                }
            ]
        }) }}
        <h2 class="govuk-heading-m">About this chart</h2>
        <p class="govuk-body">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Ab animi atque, debitis et, explicabo hic impedit, officiis quas quos ratione reiciendis sequi veritatis? Asperiores corporis ipsam nulla omnis sint vero!</p>
        <p>
            <a href="#">Download source data</a>
        </p>
		<script id="Xaxis" type="json">[{{Xaxis|safe}}]</script>
		<script id="chartData" type="json">[{{chartData}}]</script>
        <script>
            const ctx = document.getElementById('myChart');
			const axis = JSON.parse(document.getElementById('Xaxis').innerHTML)
			const data = JSON.parse(document.getElementById('chartData').innerHTML)

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: axis,
                    datasets: [{
                        label: '# of courses completed',
                        data,
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true,
							ticks: {
								precision: 0
							}
                        }
                    }
                }
            });
        </script>
    </div>
</div>
{% endblock %}
{% block pageScripts %}
    <script src="/public/javascripts/expander.js"></script>
{% endblock %}
